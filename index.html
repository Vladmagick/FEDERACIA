<!DOCTYPE html>  

<html lang="ru">  

<head>  

<meta charset="UTF-8">  

<meta name="viewport" content="width=device-width, initial-scale=1.0">  

<title>–§–ï–î–ï–†–ê–¶–ò–Ø</title>  

<script src="https://telegram.org/js/telegram-web-app.js"></script>  

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">  

<style>  

*{margin:0;padding:0;box-sizing:border-box}  

body{  

font-family:'Inter',sans-serif;  

background:linear-gradient(180deg,#0b0f17,#0f172a);  

color:#fff;  

min-height:100vh;  

overflow-x:hidden;  

}  

.app{  

max-width:430px;  

margin:0 auto;  

padding:20px 16px 110px;  

}  

h1{font-size:22px;font-weight:600;margin-bottom:16px}  

.card{  

background:rgba(255,255,255,0.06);  

backdrop-filter:blur(25px);  

border-radius:24px;  

padding:18px;  

margin-bottom:16px;  

box-shadow:0 15px 40px rgba(0,0,0,0.5);  

transition:0.25s ease;  

}  

.card:active{transform:scale(0.97)}  

input,textarea,select{  

width:100%;  

margin-top:10px;  

padding:12px;  

border-radius:16px;  

border:none;  

background:rgba(255,255,255,0.08);  

color:#fff;  

}  

button{  

margin-top:12px;  

padding:12px;  

border-radius:18px;  

border:none;  

background:rgba(255,255,255,0.1);  

color:#fff;  

transition:0.2s;  

}  

button:active{transform:scale(0.96)}  

canvas{width:100%;height:200px;cursor:pointer}  

.green{color:#00ff9d}  

.orange{color:#ff9d00}  

.red{color:#ff4d4d}  

.hidden{display:none}  

/* ===== TELEGRAM DOCK (volume glass) ===== */  

.bottom-dock{  

position:fixed;  

left:50%;  

transform:translateX(-50%);  

bottom:18px;  

width:92%;  

max-width:430px;  

height:76px;  

border-radius:38px;  

background:rgba(20,24,32,0.62);  

backdrop-filter:blur(30px);  

display:flex;  

justify-content:space-around;  

align-items:center;  

box-shadow:  

0 18px 50px rgba(0,0,0,0.55),  

inset 0 1px 0 rgba(255,255,255,0.10),  

inset 0 -1px 0 rgba(0,0,0,0.35);  

border:1px solid rgba(255,255,255,0.07);  

z-index:999;  

}  

.dock-item{  

width:72px;  

height:60px;  

border-radius:22px;  

display:flex;  

flex-direction:column;  

align-items:center;  

justify-content:center;  

color:rgba(255,255,255,0.58);  

font-size:11px;  

gap:3px;  

transition: transform .35s cubic-bezier(.2,.8,.2,1),  

color .25s ease,  

background .25s ease;  

position:relative;  

user-select:none;  

-webkit-tap-highlight-color: transparent;  

}  

.dock-item .dock-icon{  

font-size:20px;  

line-height:20px;  

transition: transform .35s cubic-bezier(.2,.8,.2,1);  

}  

.dock-item.active{  

color:#00ff9d;  

transform: translateY(-7px);  

}  

.dock-item.active::before{  

content:"";  

position:absolute;  

inset:6px;  

border-radius:18px;  

background:rgba(0,255,157,0.10);  

box-shadow:0 0 26px rgba(0,255,157,0.38);  

z-index:-1;  

}  

.dock-item:active{  

transform: translateY(-6px) scale(0.96);  

}  

.dock-item:active .dock-icon{  

transform: scale(0.90);  

}  

/* ===== Screen animation base ===== */  

.app > div{  

transition: opacity .30s ease, transform .30s ease;  

will-change: opacity, transform;  

}  

.calendar-day{  

display:inline-block;  

width:42px;height:42px;  

line-height:42px;  

text-align:center;  

margin:4px;  

border-radius:12px;  

background:rgba(255,255,255,0.06);  

font-size:13px;  

}  

.calendar-day.marked{background:#00ff9d;color:#000}  

 

/* ===== STATIC SCREENS MODE (NO JUMP) ===== */ 

html, body{ 

  height:100%; 

  overflow:hidden;              /* —É–±–∏—Ä–∞–µ–º –ø—Ä—ã–∂–∫–∏ iOS/WebView */ 

  overscroll-behavior:none; 

} 

 

.app{ 

  position:relative; 

  height:100dvh;                /* —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */ 

  overflow:hidden;              /* —Å–∫—Ä–æ–ª–ª —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —ç–∫—Ä–∞–Ω–æ–≤ */ 

  max-width:430px; 

  margin:0 auto; 

  padding:0;                    /* padding –ø–µ—Ä–µ–µ–¥–µ—Ç –≤ .screen */ 

} 

 

/* –ö–∞–∂–¥—ã–π —ç–∫—Ä–∞–Ω ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è "—Å—Ç—Ä–∞–Ω–∏—Ü–∞" */ 

.screen{ 

  position:absolute; 

  inset:0; 

  padding:20px 16px; 

  padding-bottom:calc(130px + env(safe-area-inset-bottom)); 

  overflow-y:auto; 

  -webkit-overflow-scrolling:touch; 

  display:none; 

} 

 

.screen.active{ 

  display:block; 

} 

 

/* –¥–æ–∫ —É—á–∏—Ç—ã–≤–∞–µ—Ç safe-area */ 

.bottom-dock{ 

  bottom:calc(18px + env(safe-area-inset-bottom)); 

} 

 

.dock-item{ 

  touch-action:manipulation; 

} 

 

 

/* ===== HOME DASHBOARD UI ===== */ 

.topbar{ 

  margin-top:6px; 

  display:flex; 

  align-items:center; 

  justify-content:space-between; 

  margin-bottom:14px; 

} 

.brand{display:flex;flex-direction:column;gap:4px} 

.brand-title{font-size:22px;font-weight:800;letter-spacing:0.2px} 

.brand-sub{font-size:12px;color:rgba(255,255,255,0.55)} 

.pill{ 

  padding:8px 12px; 

  border-radius:999px; 

  background:rgba(255,255,255,0.06); 

  border:1px solid rgba(255,255,255,0.08); 

  backdrop-filter:blur(20px); 

  font-size:12px; 

  color:rgba(255,255,255,0.75); 

} 

.hero{ 

  border-radius:26px; 

  padding:18px; 

  background:rgba(255,255,255,0.06); 

  border:1px solid rgba(255,255,255,0.07); 

  box-shadow:0 18px 50px rgba(0,0,0,0.45); 

} 

.hero-row{ 

  display:flex; 

  justify-content:space-between; 

  align-items:flex-start; 

  gap:12px; 

} 

.hero-title{font-size:13px;color:rgba(255,255,255,0.65)} 

.hero-value{margin-top:6px;font-size:22px;font-weight:900} 

.kpis{display:flex;gap:10px;margin-top:12px} 

.kpi{ 

  flex:1; 

  padding:12px; 

  border-radius:18px; 

  background:rgba(255,255,255,0.05); 

  border:1px solid rgba(255,255,255,0.06); 

} 

.kpi .k-label{font-size:12px;color:rgba(255,255,255,0.55)} 

.kpi .k-val{margin-top:6px;font-size:14px;font-weight:800} 

.grid3{ 

  display:grid; 

  grid-template-columns:repeat(3,1fr); 

  gap:10px; 

  margin-top:14px; 

} 

.mini-card{ 

  padding:12px; 

  border-radius:18px; 

  background:rgba(255,255,255,0.05); 

  border:1px solid rgba(255,255,255,0.06); 

} 

.mini-card .m-label{font-size:11px;color:rgba(255,255,255,0.55)} 

.mini-card .m-val{margin-top:6px;font-size:16px;font-weight:900} 

.quick-actions{display:flex;gap:10px;margin-top:14px} 

.qa{ 

  flex:1; 

  padding:12px; 

  border-radius:18px; 

  background:rgba(255,255,255,0.07); 

  border:1px solid rgba(255,255,255,0.08); 

  text-align:center; 

  font-size:12px; 

  color:rgba(255,255,255,0.92); 

  user-select:none; 

  -webkit-tap-highlight-color: transparent; 

} 

.qa:active{transform:scale(0.97)} 

.small-note{ 

  margin-top:12px; 

  font-size:12px; 

  color:rgba(255,255,255,0.55); 

  line-height:1.35; 

} 

 

 

/* ===== FINANCE v2 (plus + modal + lists) ===== */ 

.screen-header{ 

  display:flex; 

  align-items:center; 

  justify-content:space-between; 

  gap:12px; 

  margin-bottom:12px; 

} 

.h-title{ 

  font-size:26px; 

  font-weight:900; 

  letter-spacing:0.2px; 

} 

.icon-btn{ 

  width:42px;height:42px; 

  border-radius:14px; 

  display:flex;align-items:center;justify-content:center; 

  background:rgba(255,255,255,0.07); 

  border:1px solid rgba(255,255,255,0.09); 

  box-shadow:0 14px 40px rgba(0,0,0,0.35); 

  backdrop-filter:blur(18px); 

  -webkit-tap-highlight-color: transparent; 

  user-select:none; 

} 

.icon-btn:active{transform:scale(0.96)} 

.icon-plus{ 

  font-size:22px; 

  font-weight:900; 

  line-height:1; 

  color:rgba(255,255,255,0.92); 

} 

.fin-summary{ 

  display:grid; 

  grid-template-columns:1fr 1fr; 

  gap:10px; 

  margin-bottom:12px; 

} 

.fin-pill{ 

  padding:14px; 

  border-radius:20px; 

  background:rgba(255,255,255,0.06); 

  border:1px solid rgba(255,255,255,0.07); 

} 

.fin-pill .lbl{font-size:12px;color:rgba(255,255,255,0.55)} 

.fin-pill .val{margin-top:6px;font-size:18px;font-weight:900} 

.list-card{ 

  padding:14px; 

  border-radius:22px; 

  background:rgba(255,255,255,0.06); 

  border:1px solid rgba(255,255,255,0.07); 

  margin-bottom:12px; 

} 

.list-title{ 

  font-size:13px; 

  color:rgba(255,255,255,0.62); 

  margin-bottom:10px; 

} 

.list-row{ 

  display:flex; 

  justify-content:space-between; 

  gap:10px; 

  padding:10px 0; 

  border-bottom:1px solid rgba(255,255,255,0.06); 

} 

.list-row:last-child{border-bottom:none} 

.list-row .name{font-size:13px;color:rgba(255,255,255,0.9);max-width:70%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis} 

.list-row .amt{font-size:13px;font-weight:900} 

.muted{color:rgba(255,255,255,0.45)} 

 

/* Modal (bottom sheet) */ 

.modal-overlay{ 

  position:fixed; inset:0; 

  background:rgba(0,0,0,0.55); 

  display:none; 

  align-items:flex-end; 

  justify-content:center; 

  z-index:9999; 

} 

.modal-overlay.show{display:flex} 

.sheet{ 

  width:min(520px, 100%); 

  border-top-left-radius:26px; 

  border-top-right-radius:26px; 

  padding:14px 14px 18px; 

  background:rgba(18,22,32,0.92); 

  border:1px solid rgba(255,255,255,0.08); 

  backdrop-filter:blur(26px); 

  box-shadow:0 -18px 60px rgba(0,0,0,0.55); 

} 

.sheet-top{ 

  display:flex; 

  align-items:center; 

  justify-content:space-between; 

  gap:10px; 

  margin-bottom:10px; 

} 

.sheet-title{font-size:14px;font-weight:900;color:rgba(255,255,255,0.9)} 

.sheet-close{ 

  width:36px;height:36px;border-radius:12px; 

  display:flex;align-items:center;justify-content:center; 

  background:rgba(255,255,255,0.06); 

  border:1px solid rgba(255,255,255,0.08); 

} 

.sheet-close:active{transform:scale(0.96)} 

.segment{ 

  display:flex; 

  gap:8px; 

  background:rgba(255,255,255,0.05); 

  border:1px solid rgba(255,255,255,0.06); 

  border-radius:18px; 

  padding:6px; 

  margin-bottom:12px; 

} 

.seg-btn{ 

  flex:1; 

  padding:10px 10px; 

  border-radius:14px; 

  text-align:center; 

  font-size:12px; 

  color:rgba(255,255,255,0.72); 

  user-select:none; 

} 

.seg-btn.active{ 

  background:rgba(255,255,255,0.10); 

  border:1px solid rgba(255,255,255,0.10); 

  color:rgba(255,255,255,0.95); 

  box-shadow:0 10px 24px rgba(0,0,0,0.35); 

} 

.form-grid{display:grid; gap:10px; margin-bottom:12px} 

.inp{ 

  width:100%; 

  padding:14px 14px; 

  border-radius:18px; 

  background:rgba(255,255,255,0.06); 

  border:1px solid rgba(255,255,255,0.08); 

  color:#fff; 

  outline:none; 

} 

.inp::placeholder{color:rgba(255,255,255,0.35)} 

.sheet-actions{display:flex; gap:10px; align-items:center} 

.btn-primary{ 

  flex:1; 

  padding:14px 14px; 

  border-radius:18px; 

  background:rgba(0,255,157,0.16); 

  border:1px solid rgba(0,255,157,0.22); 

  color:rgba(255,255,255,0.95); 

  font-weight:900; 

  text-align:center; 

  user-select:none; 

} 

.btn-primary.disabled{ 

  opacity:0.45; 

  filter:grayscale(0.2); 

} 

 

</style>  

</head>  

<body>  

<div class="app">  

<div id="home" class="screen active"> 

 

  <div class="topbar"> 

    <div class="brand"> 

      <div class="brand-title">–§–ï–î–ï–†–ê–¶–ò–Ø</div> 

      <div class="brand-sub">Executive Control ‚Ä¢ –õ–∏—á–Ω—ã–π –∫–æ–Ω—Ç—É—Ä</div> 

    </div> 

  </div> 

 

  <div class="hero"> 

    <div class="hero-row"> 

      <div> 

        <div class="hero-title">–§–∏–Ω–∞–Ω—Å—ã ‚Äî —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</div> 

        <div class="hero-value" id="heroProfit">‚ÇΩ 0</div> 

        <div class="small-note" id="heroPercent">–ù–∞–∂–º–∏ –Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º—É ‚Üí –ø–æ–∫–∞–∂—É –ø—Ä–æ—Ü–µ–Ω—Ç—ã</div> 

      </div> 

      <div style="width:170px;"> 

        <canvas id="chart" style="height:160px;"></canvas> 

      </div> 

    </div> 

 

    <div class="kpis"> 

      <div class="kpi"> 

        <div class="k-label">–î–æ—Ö–æ–¥</div> 

        <div class="k-val green" id="kIncome">‚ÇΩ 0</div> 

      </div> 

      <div class="kpi"> 

        <div class="k-label">–†–∞—Å—Ö–æ–¥</div> 

        <div class="k-val red" id="kExpense">‚ÇΩ 0</div> 

      </div> 

      <div class="kpi"> 

        <div class="k-label">–ú–∞—Ä–∂–∞</div> 

        <div class="k-val orange" id="kMargin">0%</div> 

      </div> 

    </div> 

  </div> 

 

  <div class="grid3"> 

    <div class="mini-card"> 

      <div class="m-label">–í —Ä–∞–±–æ—Ç–µ</div> 

      <div class="m-val orange" id="mWork">0</div> 

    </div> 

    <div class="mini-card"> 

      <div class="m-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div> 

      <div class="m-val green" id="mDone">0</div> 

    </div> 

    <div class="mini-card"> 

      <div class="m-label">–ó–∞–¥–µ—Ä–∂–∫–∏</div> 

      <div class="m-val red" id="mDelay">0</div> 

    </div> 

  </div> 

 

</div> 

 

<div id="finance" class="screen"> 

 

  <div class="screen-header"> 

    <div class="h-title">–§–∏–Ω–∞–Ω—Å—ã</div> 

    <div class="icon-btn" id="finAddBtn" title="–î–æ–±–∞–≤–∏—Ç—å"> 

      <div class="icon-plus">+</div> 

    </div> 

  </div> 

 

  <div class="fin-summary"> 

    <div class="fin-pill"> 

      <div class="lbl">–î–æ—Ö–æ–¥</div> 

      <div class="val green" id="sumIncome">‚ÇΩ 0</div> 

    </div> 

    <div class="fin-pill"> 

      <div class="lbl">–†–∞—Å—Ö–æ–¥</div> 

      <div class="val red" id="sumExpense">‚ÇΩ 0</div> 

    </div> 

  </div> 

 

  <div class="list-card"> 

    <div class="list-title">–î–æ—Ö–æ–¥—ã ‚Äî –æ—Ç –∫–æ–≥–æ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è</div> 

    <div id="incomeList" class="muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div> 

  </div> 

 

  <div class="list-card"> 

    <div class="list-title">–†–∞—Å—Ö–æ–¥—ã ‚Äî –∫–æ–º—É –æ—Ç–ø—Ä–∞–≤–ª—è–ª</div> 

    <div id="expenseList" class="muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div> 

  </div> 

 

</div> 

 

<!-- Finance modal --> 

<div class="modal-overlay" id="finModal"> 

  <div class="sheet"> 

    <div class="sheet-top"> 

      <div class="sheet-title" id="finModalTitle">–î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</div> 

      <div class="sheet-close" id="finCloseBtn">‚úï</div> 

    </div> 

 

    <div class="segment"> 

      <div class="seg-btn active" id="segIncome">–î–æ—Ö–æ–¥</div> 

      <div class="seg-btn" id="segExpense">–†–∞—Å—Ö–æ–¥</div> 

    </div> 

 

    <div class="form-grid" id="finForm"> 

      <!-- dynamic fields --> 

    </div> 

 

    <div class="sheet-actions"> 

      <div class="btn-primary disabled" id="finDoneBtn">–ì–æ—Ç–æ–≤–æ</div> 

    </div> 

  </div> 

</div> 

 

<div id="objects" class="screen">  

<h1>–û–±—ä–µ–∫—Ç—ã</h1>  

<div class="card">  

<textarea id="objectInput" placeholder="–ù–æ–≤—ã–π –æ–±—ä–µ–∫—Ç"></textarea>  

<button onclick="addObject()">–î–æ–±–∞–≤–∏—Ç—å</button>  

</div>  

<div id="objectList"></div>  

</div>  

<div id="calendar" class="screen">  

<h1>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</h1>  

<div class="card">  

<div id="calendarGrid"></div>  

</div>  

</div>  

<div id="decisions" class="screen">  

<h1>–†–µ—à–µ–Ω–∏—è</h1>  

<div class="card">  

<textarea id="decisionInput" placeholder="–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ"></textarea>  

<button onclick="addDecision()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>  

</div>  

<div id="decisionList"></div>  

</div>  

</div>  

<div class="bottom-dock">  

<div class="dock-item active" onclick="switchTab('home', this)">  

<div class="dock-icon">üë§</div>  

<div class="dock-label">–ì–ª–∞–≤–Ω–∞—è</div>  

</div>  

<div class="dock-item" onclick="switchTab('finance', this)">  

<div class="dock-icon">üí∞</div>  

<div class="dock-label">–§–∏–Ω–∞–Ω—Å—ã</div>  

</div>  

<div class="dock-item" onclick="switchTab('objects', this)">  

<div class="dock-icon">üí¨</div>  

<div class="dock-label">–û–±—ä–µ–∫—Ç—ã</div>  

</div>  

<div class="dock-item" onclick="switchTab('calendar', this)">  

<div class="dock-icon">üìÖ</div>  

<div class="dock-label">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</div>  

</div>  

<div class="dock-item" onclick="switchTab('decisions', this)">  

<div class="dock-icon">üß†</div>  

<div class="dock-label">–†–µ—à–µ–Ω–∏—è</div>  

</div>  

</div>  

<script>  

const tg = window.Telegram.WebApp;  

tg.expand(); tg.ready();  

let objects = JSON.parse(localStorage.getItem("objects"))||[];  

let finances = JSON.parse(localStorage.getItem("finances"))||[];  

let decisions = JSON.parse(localStorage.getItem("decisions"))||[];  

 

// ===== Finance Entries v2 ===== 

let financeEntries = JSON.parse(localStorage.getItem("fed_fin_entries") || "[]"); 

 

// migrate old format (if exists) 

(function migrateOldFinances(){ 

  try{ 

    const old = JSON.parse(localStorage.getItem("finances") || "null"); 

    if(Array.isArray(old) && old.length && financeEntries.length === 0){ 

      old.forEach(x=>{ 

        const inc = Number(x.income||0); 

        const exp = Number(x.expense||0); 

        const ts = x.ts || Date.now(); 

        if(inc>0){ 

          financeEntries.push({id: crypto?.randomUUID?.() || String(Math.random()), type:"income", counterparty:(x.from||x.object||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"), note:"", amount:inc, ts}); 

        } 

        if(exp>0){ 

          financeEntries.push({id: crypto?.randomUUID?.() || String(Math.random()), type:"expense", counterparty:(x.to||x.object||"–ù–µ —É–∫–∞–∑–∞–Ω–æ"), note:"", amount:exp, ts}); 

        } 

      }); 

      localStorage.setItem("fed_fin_entries", JSON.stringify(financeEntries)); 

    } 

  }catch(e){} 

})(); 

 

function saveFinanceEntries(){ 

  localStorage.setItem("fed_fin_entries", JSON.stringify(financeEntries)); 

} 

 

function fmtRub(n){ 

  return "‚ÇΩ " + Math.round(Number(n)||0).toLocaleString("ru-RU"); 

} 

 

function escapeHtml(str){ 

  return String(str||"") 

    .replaceAll("&","&amp;") 

    .replaceAll("<","&lt;") 

    .replaceAll(">","&gt;") 

    .replaceAll('"',"&quot;") 

    .replaceAll("'","&#039;"); 

} 

let __switching = false;  

function switchTab(id, el){ 

  // –∞–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –≤ –¥–æ–∫–µ 

  document.querySelectorAll(".dock-item").forEach(n=>n.classList.remove("active")); 

  el.classList.add("active"); 

 

  // –∞–Ω—Ç–∏-bounce –≤ Telegram (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è) 

  try{ tg.disableVerticalSwipes?.(); }catch(e){} 

 

  // –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤ (–°–¢–ê–¢–ò–ß–ù–û, –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–π) 

  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active")); 

  const next = document.getElementById(id); 

  next.classList.add("active"); 

 

  // —Å–±—Ä–æ—Å —Å–∫—Ä–æ–ª–ª–∞ —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —ç–∫—Ä–∞–Ω–∞ 

  next.scrollTop = 0; 

 

  // haptic (Telegram) 

  try{ 

    if(window.Telegram?.WebApp?.HapticFeedback){ 

      Telegram.WebApp.HapticFeedback.impactOccurred("light"); 

    } 

  }catch(e){} 

} 

function addObject(){  

let text=document.getElementById("objectInput").value;  

if(!text)return;  

objects.push(text);  

localStorage.setItem("objects",JSON.stringify(objects));  

 

function recalcHome(){ 

  // objects summary (–ø–æ–∫–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É) 

  const mWork = document.getElementById("mWork"); 

  const mDone = document.getElementById("mDone"); 

  const mDelay = document.getElementById("mDelay"); 

  if(mWork) mWork.textContent = objects.length; 

  if(mDone) mDone.textContent = 0; 

  if(mDelay) mDelay.textContent = 0; 

 

  drawChart(); 

} 

 

function openQuick(type){ 

  const items = document.querySelectorAll(".dock-item"); 

  if(type === "expense"){ 

    switchTab("finance", items[1]); 

    const exp = document.getElementById("finAddBtn"); 

    exp?.focus?.(); 

  } 

  if(type === "object"){ 

    switchTab("objects", items[2]); 

    const oi = document.getElementById("objectInput"); 

    oi?.focus?.(); 

  } 

  if(type === "decision"){ 

    switchTab("decisions", items[4]); 

    const di = document.getElementById("decisionInput"); 

    di?.focus?.(); 

  } 

} 

 

 

// ===== Finance Modal Logic ===== 

let finMode = "income"; 

const finModal = document.getElementById("finModal"); 

const finAddBtn = document.getElementById("finAddBtn"); 

const finCloseBtn = document.getElementById("finCloseBtn"); 

const segIncome = document.getElementById("segIncome"); 

const segExpense = document.getElementById("segExpense"); 

const finForm = document.getElementById("finForm"); 

const finDoneBtn = document.getElementById("finDoneBtn"); 

 

function openFinModal(){ 

  if(!finModal) return; 

  finModal.classList.add("show"); 

  setFinMode("income"); 

  buildFinForm(); 

  validateFinForm(); 

} 

function closeFinModal(){ 

  finModal?.classList.remove("show"); 

} 

function setFinMode(mode){ 

  finMode = mode; 

  segIncome?.classList.toggle("active", mode==="income"); 

  segExpense?.classList.toggle("active", mode==="expense"); 

  buildFinForm(); 

  validateFinForm(); 

} 

function nowLocalString(){ 

  try{ 

    return new Date().toLocaleString("ru-RU", {hour12:false}); 

  }catch(e){ return new Date().toString(); } 

} 

function buildFinForm(){ 

  if(!finForm) return; 

  const dt = nowLocalString(); 

  if(finMode==="income"){ 

    finForm.innerHTML = ` 

      <input class="inp" id="fFrom" placeholder="–û—Ç –∫–æ–≥–æ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è" /> 

      <input class="inp" id="fAmount" placeholder="–°—É–º–º–∞" inputmode="numeric" /> 

      <input class="inp" id="fDT" value="${dt}" disabled /> 

    `; 

  }else{ 

    finForm.innerHTML = ` 

      <input class="inp" id="fTo" placeholder="–ö–æ–º—É" /> 

      <input class="inp" id="fWhat" placeholder="–ó–∞ —á—Ç–æ" /> 

      <input class="inp" id="fAmount" placeholder="–°—É–º–º–∞" inputmode="numeric" /> 

      <input class="inp" id="fDT" value="${dt}" disabled /> 

    `; 

  } 

  // bind validation 

  finForm.querySelectorAll("input").forEach(i=>{ 

    i.addEventListener("input", validateFinForm); 

  }); 

} 

function validateFinForm(){ 

  if(!finDoneBtn) return false; 

  let ok = false; 

  const amount = Number((document.getElementById("fAmount")?.value || "").replace(",", ".")); 

  if(finMode==="income"){ 

    const from = (document.getElementById("fFrom")?.value || "").trim(); 

    ok = from.length>0 && amount>0; 

  }else{ 

    const to = (document.getElementById("fTo")?.value || "").trim(); 

    const what = (document.getElementById("fWhat")?.value || "").trim(); 

    ok = to.length>0 && what.length>0 && amount>0; 

  } 

  finDoneBtn.classList.toggle("disabled", !ok); 

  return ok; 

} 

function submitFinForm(){ 

  if(!validateFinForm()) return; 

  const ts = Date.now(); 

  const amount = Number((document.getElementById("fAmount")?.value || "").replace(",", ".")); 

  if(finMode==="income"){ 

    const from = (document.getElementById("fFrom")?.value || "").trim(); 

    financeEntries.unshift({ 

      id: crypto?.randomUUID?.() || String(Math.random()), 

      type:"income", 

      counterparty: from, 

      note:"", 

      amount, 

      ts 

    }); 

  }else{ 

    const to = (document.getElementById("fTo")?.value || "").trim(); 

    const what = (document.getElementById("fWhat")?.value || "").trim(); 

    financeEntries.unshift({ 

      id: crypto?.randomUUID?.() || String(Math.random()), 

      type:"expense", 

      counterparty: to, 

      note: what, 

      amount, 

      ts 

    }); 

  } 

  saveFinanceEntries(); 

  closeFinModal(); 

  renderFinance(); 

} 

 

finAddBtn?.addEventListener("click", openFinModal); 

finCloseBtn?.addEventListener("click", closeFinModal); 

finModal?.addEventListener("click", (e)=>{ if(e.target===finModal) closeFinModal(); }); 

segIncome?.addEventListener("click", ()=>setFinMode("income")); 

segExpense?.addEventListener("click", ()=>setFinMode("expense")); 

finDoneBtn?.addEventListener("click", submitFinForm); 

 

renderObjects(); 

recalcHome();  

document.getElementById("objectInput").value="";  

}  

function renderFinance(){ 

  const sumIncome = document.getElementById("sumIncome"); 

  const sumExpense = document.getElementById("sumExpense"); 

  const incomeList = document.getElementById("incomeList"); 

  const expenseList = document.getElementById("expenseList"); 

 

  const incomeTotal = financeEntries.filter(e=>e.type==="income").reduce((a,b)=>a+(Number(b.amount)||0),0); 

  const expenseTotal = financeEntries.filter(e=>e.type==="expense").reduce((a,b)=>a+(Number(b.amount)||0),0); 

  if(sumIncome) sumIncome.textContent = fmtRub(incomeTotal); 

  if(sumExpense) sumExpense.textContent = fmtRub(expenseTotal); 

 

  const groupBy = (arr)=>{ 

    const m = new Map(); 

    arr.forEach(e=>{ 

      const key = (e.counterparty||"–ù–µ —É–∫–∞–∑–∞–Ω–æ").trim(); 

      m.set(key, (m.get(key)||0) + (Number(e.amount)||0)); 

    }); 

    return Array.from(m.entries()).sort((a,b)=>b[1]-a[1]); 

  }; 

 

  const makeRows = (pairs, colorClass)=>{ 

    if(!pairs.length) return '<div class="muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div>'; 

    return pairs.slice(0,30).map(([name,sum])=>` 

      <div class="list-row"> 

        <div class="name">${escapeHtml(name)}</div> 

        <div class="amt ${colorClass}">${fmtRub(sum)}</div> 

      </div> 

    `).join(""); 

  }; 

 

  if(incomeList) incomeList.innerHTML = makeRows(groupBy(financeEntries.filter(e=>e.type==="income")), "green"); 

  if(expenseList) expenseList.innerHTML = makeRows(groupBy(financeEntries.filter(e=>e.type==="expense")), "red"); 

 

  // refresh home chart + KPIs 

  recalcHome(); 

} 

// function renderObjects (dup line fixed) 

function renderObjects(){  

let list=document.getElementById("objectList");  

list.innerHTML="";  

objects.forEach(o=>{  

let div=document.createElement("div");  

div.className="card";  

div.innerText=o;  

list.appendChild(div);  

});  

}  

// ); 

// } 

function drawChart(){  

const canvas=document.getElementById("chart");  

if(!canvas) return; 

const ctx=canvas.getContext("2d");  

canvas.width=350; canvas.height=200;  

 

let totalIncome = financeEntries.filter(e=>e.type==="income").reduce((a,b)=>a+(Number(b.amount)||0),0); 

let totalExpense = financeEntries.filter(e=>e.type==="expense").reduce((a,b)=>a+(Number(b.amount)||0),0); 

let profit=totalIncome-totalExpense; 

 

let percent=(totalExpense/(totalIncome||1))*180;  

ctx.clearRect(0,0,canvas.width,canvas.height);  

 

// expense (red) 

ctx.beginPath();  

ctx.arc(175,180,150,Math.PI,Math.PI+(percent*Math.PI/180));  

ctx.lineWidth=22; ctx.strokeStyle="#ff4d4d"; ctx.stroke();  

 

// income remainder (green) 

ctx.beginPath();  

ctx.arc(175,180,150,Math.PI+(percent*Math.PI/180),2*Math.PI);  

ctx.lineWidth=22; ctx.strokeStyle="#00ff9d"; ctx.stroke();  

 

// Update Home KPIs 

const fmt = (n)=>("‚ÇΩ "+Math.round(n).toLocaleString("ru-RU")); 

const kIncome = document.getElementById("kIncome"); 

const kExpense = document.getElementById("kExpense"); 

const heroProfit = document.getElementById("heroProfit"); 

const kMargin = document.getElementById("kMargin"); 

 

if(kIncome) kIncome.textContent = fmt(totalIncome); 

if(kExpense) kExpense.textContent = fmt(totalExpense); 

if(heroProfit) heroProfit.textContent = fmt(profit); 

if(kMargin){ 

  const margin = totalIncome>0 ? Math.round((profit/totalIncome)*100) : 0; 

  kMargin.textContent = margin + "%"; 

} 

 

// Click -> show percentages 

canvas.onclick=function(){  

  const expP = totalIncome>0 ? Math.round((totalExpense/totalIncome)*100) : 0; 

  const profP = totalIncome>0 ? Math.round((profit/totalIncome)*100) : 0; 

  const heroPercent = document.getElementById("heroPercent"); 

  if(heroPercent){ 

    heroPercent.textContent = "–†–∞—Å—Ö–æ–¥: " + expP + "% ‚Ä¢ –ü—Ä–∏–±—ã–ª—å: " + profP + "%"; 

  }else{ 

    alert("–î–æ—Ö–æ–¥: "+fmt(totalIncome)+"\n–†–∞—Å—Ö–æ–¥: "+fmt(totalExpense)+"\n–ü—Ä–∏–±—ã–ª—å: "+fmt(profit)); 

  } 

}; 

}  

function renderCalendar(){  

let grid=document.getElementById("calendarGrid");  

grid.innerHTML="";  

for(let i=1;i<=30;i++){  

let day=document.createElement("div");  

day.className="calendar-day";  

day.innerText=i;  

day.onclick=function(){day.classList.toggle("marked");}  

grid.appendChild(day);  

}  

}  

function addDecision(){  

let text=document.getElementById("decisionInput").value;  

if(!text)return;  

decisions.push(text);  

localStorage.setItem("decisions",JSON.stringify(decisions));  

renderDecisions(); recalcHome();  

document.getElementById("decisionInput").value="";  

}  

function renderDecisions(){  

let list=document.getElementById("decisionList");  

list.innerHTML="";  

decisions.forEach(d=>{  

let div=document.createElement("div");  

div.className="card";  

div.innerText=d;  

list.appendChild(div);  

});  

}  

renderObjects(); 

renderFinance();  

renderCalendar();  

renderDecisions(); recalcHome();  

drawChart();  

recalcHome(); 

</script>  

</body>  

</html> 
